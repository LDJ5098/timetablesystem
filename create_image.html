<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Info Display</title>
    <style>
        body {
            background-color: white;
        }

        #bitmapOutput {
            white-space: pre-wrap; /* 줄 바꿈을 유지합니다 */
            font-family: monospace; /* 고정폭 글꼴을 사용합니다 */
        }
    </style>
</head>
<body>
    <!--
        <img id="imageOutput" /> 
    -->

    <div id="bitmapOutput"></div>
    <script>
        function drawClassInfo(courseName, professorName, startTime, endTime) {
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 480;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = 'black';
            ctx.font = '80px Arial';

            // 각 텍스트의 높이 계산
            const lineHeight = 100;
            const totalTextHeight = 3 * lineHeight; // 3줄의 텍스트 총 높이

            // 텍스트의 시작 y 좌표 계산
            const startY = (canvas.height - totalTextHeight) / 2 + lineHeight - 20;

            // 텍스트 너비 계산 및 출력
            let text = courseName;
            let textWidth = ctx.measureText(text).width;
            ctx.fillText(text, (canvas.width - textWidth) / 2, startY);

            text = `(${professorName})`;
            textWidth = ctx.measureText(text).width;
            ctx.fillText(text, (canvas.width - textWidth) / 2, startY + lineHeight);

            text = `${startTime} - ${endTime}`;
            textWidth = ctx.measureText(text).width;
            ctx.fillText(text, (canvas.width - textWidth) / 2, startY + 2 * lineHeight);

            // 캔버스에서 이미지 데이터를 가져옴
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            // 흑백 비트맵을 저장할 배열 생성
            let bitmap = [];
            for (let i = 0; i < data.length; i += 4) {
                // rgba 값에서 흑백 값 계산
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                const avg = (r + g + b) / 3;

                // 흑백 값을 0 또는 1로 변환
                const bit = avg < 128 ? 1 : 0;
                bitmap.push(bit);
            }

            // 비트맵 데이터를 16진수 문자열로 변환
            let hexString = "";
            let count=0;
            for (let i = 0; i < bitmap.length; i += 8) {
                let byte = 0;
                for (let bit = 0; bit < 8; bit++) {
                    if (bitmap[i + bit]) {
                        byte |= 1 << (7 - bit);
                    }
                }
                hexString += "0x" + byte.toString(16).padStart(2, '0') + "/";
                count++;
                /*if ((i / 8 + 1) % 16 === 0) {
                    hexString += "\n";
                }*/
                
            }

            // 결과를 HTML 요소에 출력
            const bitmapOutput = document.getElementById('bitmapOutput');
            bitmapOutput.textContent = "/X1345247::SET::/" + hexString + "/";

            // 이미지를 보여줌
            const image = canvas.toDataURL('image/png');
            //document.getElementById('imageOutput').src = image;

            console.log(bitmap.length, count);
        }

        // 예제 데이터
        drawClassInfo('프로그래밍 언어', '소지영', '09:00', '12:00');
    </script>
</body>
</html>
